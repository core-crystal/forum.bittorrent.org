<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">

<html xmlns="http://www.w3.org/1999/xhtml" dir="ltr">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<title>forum.bittorrent.org / Discussion of BEP 10: Extension Protocol</title>
<link rel="stylesheet" type="text/css" href="style/Kontrast.css" />
</head>
<body>

<div id="punwrap">
<div id="punviewtopic" class="pun">

<div id="brdheader" class="block">
	<div class="box">
		<div id="brdtitle" class="inbox">
			<h1><span>forum.bittorrent.org</span></h1>
			<p><span>BitTorrent.org community</span></p>
		</div>
		<div id="brdmenu" class="inbox">
			<ul>
				<li id="navindex"><a href="index.php">Index</a></li>
				<li id="navextra1"><a href="http://forum.bittorrent.org">Homepage</a></li>
				<li id="navextra2"><a href="irc://irc.freenode.net/bittorrent">IRC</a></li>
				<li id="navuserlist"><a href="userlist.php">User list</a></li>
				<li id="navrules"><a href="misc.php?action=rules">Rules</a></li>
				<li id="navsearch"><a href="search.php">Search</a></li>
				<li id="navregister"><a href="register.php">Register</a></li>
				<li id="navlogin"><a href="login.php">Login</a></li>
			</ul>
		</div>
		<div id="brdwelcome" class="inbox">
			<p>You are not logged in.</p>
		</div>
	</div>
</div>

<div id="announce" class="block">
	<h2><span>Announcement</span></h2>
	<div class="box">
		<div class="inbox">
			<div>Posting about any illegal sharing of copyrighted content is strictly forbidden.</div>
		</div>
	</div>
</div>

<div class="linkst">
	<div class="inbox">
		<p class="pagelink conl">Pages: <strong>1</strong>&nbsp;<a href="viewtopic.php?id=16&amp;p=2">2</a></p>
		<p class="postlink conr">&nbsp;</p>
		<ul><li><a href="index.php">Index</a></li><li>&nbsp;&raquo;&nbsp;<a href="viewforum.php?id=25">BEPs</a></li><li>&nbsp;&raquo;&nbsp;Discussion of BEP 10: Extension Protocol</li></ul>
		<div class="clearer"></div>
	</div>
</div>

<div id="p35" class="blockpost rowodd firstpost">
	<h2><span><span class="conr">#1&nbsp;</span><a href="viewtopic.php?pid=35#p35">2008-03-04 14:58:54</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postleft">
				<dl>
					<dt><strong><a href="profile.php?id=89601">dave</a></strong></dt>
					<dd class="usertitle"><strong>Editor</strong></dd>
					<dd class="postavatar"></dd>
				</dl>
			</div>
			<div class="postright">
				<h3>Discussion of BEP 10: Extension Protocol</h3>
				<div class="postmsg">
					<p>Introduced by LibTorrent, this mechanism reduces the probabililty of collisions in bit allocations in the reserved bytes in the BitTorrent handshake by using named (string) extensions as opposed to message IDs.<br /><br /><a href="http://www.bittorrent.org/beps/bep_0010.html" rel="nofollow">http://www.bittorrent.org/beps/bep_0010.html</a><br /><br />This extension is implemented in uTorrent and is used for the Metadata Extension.</p>
				</div>
			</div>
			<div class="clearer"></div>
			<div class="postfootleft"><p>Offline</p></div>
			<div class="postfootright"><div>&nbsp;</div></div>
		</div>
	</div>
</div>

<div id="p36" class="blockpost roweven">
	<h2><span><span class="conr">#2&nbsp;</span><a href="viewtopic.php?pid=36#p36">2008-03-04 15:28:38</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postleft">
				<dl>
					<dt><strong><a href="profile.php?id=89618">The 8472</a></strong></dt>
					<dd class="usertitle"><strong>Azureus Developer</strong></dd>
					<dd class="postavatar"></dd>
				</dl>
			</div>
			<div class="postright">
				<h3> Re: Discussion of BEP 10: Extension Protocol</h3>
				<div class="postmsg">
					<p>although LTEP (as we Az devs call it) is useful it has several shortcomings compared to the azureus messaging protocol (AZMP):<br />-it cannot be used as standalone protocol to phase out the classic bittorrent handshake<br />-classic bittorrent messages are not first class messages under this protocol and thus still have to be negotiated via the bitfield<br />-it wastes message space by prefixing all LTEP-messages with a constant ID only to use an own internal ID. if all messages were handled by it the message space would be 65k<br />-messages are not versioned, azureus supports versioning of messages to indicate change of semantics or added fields w/o adding complexity to the protocol itself<br />-AZMP supports message-paddings, which is used to augment encrypted transports to harden them against size-pattern analysis<br /><br /><br />AZMP in turn has one significant shortcoming, it does not use message IDs but message names. We could change this if other developers would want to adopt AZMP but won't do so due to the increased overhead, but we haven't felt the need so far as we reduce the most significant overhead - the have message - by coalescing haves into a single message.<br /><br /><br />I would suggest designing a new messaging protocol or extending one of both existing protocols. A sunset procedure to phase out classic bittorrent headers with their bitfield and other inflexible properties would be an important goal to me. A more flexible messaging protocol would even be able accommodate future p2p applications with similar messaging needs if designed properly.</p>
					<p class="postedit"><em>Last edited by The 8472 (2008-03-04 15:29:31)</em></p>
				</div>
				<div class="postsignature"><hr />Az dev</div>
			</div>
			<div class="clearer"></div>
			<div class="postfootleft"><p>Offline</p></div>
			<div class="postfootright"><div>&nbsp;</div></div>
		</div>
	</div>
</div>

<div id="p78" class="blockpost rowodd">
	<h2><span><span class="conr">#3&nbsp;</span><a href="viewtopic.php?pid=78#p78">2008-03-07 10:46:52</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postleft">
				<dl>
					<dt><strong><a href="profile.php?id=89602">arvid</a></strong></dt>
					<dd class="usertitle"><strong>Administrator</strong></dd>
					<dd class="postavatar"></dd>
				</dl>
			</div>
			<div class="postright">
				<h3> Re: Discussion of BEP 10: Extension Protocol</h3>
				<div class="postmsg">
					<p>&gt;although LTEP (as we Az devs call it) is useful it has several shortcomings compared to the azureus messaging protocol (AZMP):<br />&gt;-it cannot be used as standalone protocol to phase out the classic bittorrent handshake<br /><br />I consider that a benefit, and I would phrase it like this: &quot;it blends in with the spirit of the bittorrent protocol as opposed to replacing it&quot;<br /><br />&gt;-classic bittorrent messages are not first class messages under this protocol and thus still have to be negotiated via the bitfield<br />&gt;-it wastes message space by prefixing all LTEP-messages with a constant ID only to use an own internal ID. if all<br />&gt;messages were handled by it the message space would be 65k<br /><br />These two points are the same, and I agree. I would have preferred if the message IDs that were negotiated were in the same message space as the other bittorrent messages. (iirc ludde pushed for the current solution and I pushed for sharing message space with regular bittorrent messages). The reason why we designed it this way was because we didn't feel we had enough authority and we were worried that new bittorrent messages would be added and collide with our extensions. That's why the single message ID we picked has some headroom between the highest bittorrent message ID.<br /><br />&gt;-messages are not versioned, azureus supports versioning of messages to indicate change of semantics or added<br />&gt;fields w/o adding complexity to the protocol itself<br /><br />I consider that an unnecessary complication. Messages don't have to be versioned if you can replace them. Versioning messages introduces another place to change semantics of messages and it is less clear if a message should change semantics by bumping the version number or replace it with a new message. Having fewer choices makes it simpler and less likely to cause confusion.<br /><br />For example, if the metadata extension has to be &quot;updated&quot;, the new message could be called &quot;ut_metadata2&quot;. That is versioning.<br /><br />&gt;-AZMP supports message-paddings, which is used to augment encrypted transports to harden them against size-<br />&gt;pattern analysis<br /><br />and bittorrent supports keepalive messages, which has the same effect as padding.<br /><br />&gt;AZMP in turn has one significant shortcoming, it does not use message IDs but message names. We could change this if other developers would want &gt;to adopt AZMP but won't do so due to the increased overhead, but we haven't felt the need so far as we reduce the most significant overhead - the &gt;have message - by coalescing haves into a single message.<br /><br /><br />&gt;I would suggest designing a new messaging protocol or extending one of both existing protocols. A sunset procedure to phase out classic bittorrent<br /><br />why?<br /><br />&gt;headers with their bitfield and other inflexible properties would be an important goal to me. A more flexible messaging protocol would even be able<br />&gt;accommodate future p2p applications with similar messaging needs if designed properly.</p>
				</div>
			</div>
			<div class="clearer"></div>
			<div class="postfootleft"><p>Offline</p></div>
			<div class="postfootright"><div>&nbsp;</div></div>
		</div>
	</div>
</div>

<div id="p80" class="blockpost roweven">
	<h2><span><span class="conr">#4&nbsp;</span><a href="viewtopic.php?pid=80#p80">2008-03-07 12:45:07</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postleft">
				<dl>
					<dt><strong><a href="profile.php?id=89601">dave</a></strong></dt>
					<dd class="usertitle"><strong>Editor</strong></dd>
					<dd class="postavatar"></dd>
				</dl>
			</div>
			<div class="postright">
				<h3> Re: Discussion of BEP 10: Extension Protocol</h3>
				<div class="postmsg">
					<p>Were message ID collisions ever a big deal? <br />Can anyone give me an example of where it occurred?<br /><br />Re: AZMP<br />Why incur additional parsing overhead on every message?<br />LibTorrent's solution at least only adds overhead on the new message types.<br /><br />Though I'm not yet convinced that any extension protocol is necessary.</p>
				</div>
			</div>
			<div class="clearer"></div>
			<div class="postfootleft"><p>Offline</p></div>
			<div class="postfootright"><div>&nbsp;</div></div>
		</div>
	</div>
</div>

<div id="p81" class="blockpost rowodd">
	<h2><span><span class="conr">#5&nbsp;</span><a href="viewtopic.php?pid=81#p81">2008-03-07 13:39:58</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postleft">
				<dl>
					<dt><strong><a href="profile.php?id=89601">dave</a></strong></dt>
					<dd class="usertitle"><strong>Editor</strong></dd>
					<dd class="postavatar"></dd>
				</dl>
			</div>
			<div class="postright">
				<h3> Re: Discussion of BEP 10: Extension Protocol</h3>
				<div class="postmsg">
					<p>As suggested by 8742, I REALLY like the idea of coalescing have messages into a single packet, because it would reduce the number of small fixed size packets.&nbsp; This would remove one very easy way to identify BitTorrent traffic.&nbsp; <br /><br />But this doesn't require changing the protocol.&nbsp; Just hold on to haves for a few seconds put several HAVE messages in the same write() call and do some randomization.<br /><br />Coalescing HAVE messages of course also reduces overhead which is greater with small pieces and large numbers of connections.&nbsp; This could have a significant impact on streaming which inherently does not tolerate multi-MB pieces and Teredo which increases header overhead.&nbsp; For example, 16KB pieces, 150 connections.<br /><br />&nbsp; teredo header overhead = IPv4 + UDP + IPv6 + TCP = 20 + 8 + 40 + 20 = 88<br />&nbsp; haves =&nbsp; 150 * (9 + 88)&nbsp; = 14550 bytes of HAVE packets per piece <br /><br />Uh-oh.&nbsp; The number of bytes of HAVE packets nearly equals the size of the original piece.</p>
				</div>
			</div>
			<div class="clearer"></div>
			<div class="postfootleft"><p>Offline</p></div>
			<div class="postfootright"><div>&nbsp;</div></div>
		</div>
	</div>
</div>

<div id="p82" class="blockpost roweven">
	<h2><span><span class="conr">#6&nbsp;</span><a href="viewtopic.php?pid=82#p82">2008-03-07 13:55:40</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postleft">
				<dl>
					<dt><strong><a href="profile.php?id=89602">arvid</a></strong></dt>
					<dd class="usertitle"><strong>Administrator</strong></dd>
					<dd class="postavatar"></dd>
				</dl>
			</div>
			<div class="postright">
				<h3> Re: Discussion of BEP 10: Extension Protocol</h3>
				<div class="postmsg">
					<blockquote><div class="incqbox"><h4>dave wrote:</h4><p>Were message ID collisions ever a big deal? <br />Can anyone give me an example of where it occurred?</p></div></blockquote><p>iirc, the DHT port message collided with XBT client's peer exchange message.</p>
				</div>
			</div>
			<div class="clearer"></div>
			<div class="postfootleft"><p>Offline</p></div>
			<div class="postfootright"><div>&nbsp;</div></div>
		</div>
	</div>
</div>

<div id="p84" class="blockpost rowodd">
	<h2><span><span class="conr">#7&nbsp;</span><a href="viewtopic.php?pid=84#p84">2008-03-07 14:19:12</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postleft">
				<dl>
					<dt><strong><a href="profile.php?id=89601">dave</a></strong></dt>
					<dd class="usertitle"><strong>Editor</strong></dd>
					<dd class="postavatar"></dd>
				</dl>
			</div>
			<div class="postright">
				<h3> Re: Discussion of BEP 10: Extension Protocol</h3>
				<div class="postmsg">
					<p>Hmmm.... <br /><br />LTEP could be used as a mechanism for experimenting with new messages. <br /><br />If something is valuable enough and common enough it could be moved into the core protocol with handshake bits and message ids allocated as envisioned by Bram.<br /><br />This may be something that warrants BDFL's commentary.</p>
				</div>
			</div>
			<div class="clearer"></div>
			<div class="postfootleft"><p>Offline</p></div>
			<div class="postfootright"><div>&nbsp;</div></div>
		</div>
	</div>
</div>

<div id="p85" class="blockpost roweven">
	<h2><span><span class="conr">#8&nbsp;</span><a href="viewtopic.php?pid=85#p85">2008-03-07 17:41:07</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postleft">
				<dl>
					<dt><strong><a href="profile.php?id=89618">The 8472</a></strong></dt>
					<dd class="usertitle"><strong>Azureus Developer</strong></dd>
					<dd class="postavatar"></dd>
				</dl>
			</div>
			<div class="postright">
				<h3> Re: Discussion of BEP 10: Extension Protocol</h3>
				<div class="postmsg">
					<blockquote><div class="incqbox"><p>I consider that a benefit, and I would phrase it like this: &quot;it blends in with the spirit of the bittorrent protocol as opposed to replacing it&quot;</p></div></blockquote><p>I do not see how keeping (comparatively) stupid legacy features like the bitfield around instead of replacing it with something better, such as dynamic handshaking. And i don't see how it's the &quot;spririt of bittorrent&quot; either. To me &quot;the spirit of bittorrent&quot; is efficient, flexible mass distribution of data. The current state is not flexible and slightly inefficient.<br /><br /></p><blockquote><div class="incqbox"><p>Why incur additional parsing overhead on every message?</p></div></blockquote><p>uhm... if you only have one messaging protocol where every message is a 1st class citizen then i don't see any additional parsing overhead.<br /><br /></p><blockquote><div class="incqbox"><p>For example, if the metadata extension has to be &quot;updated&quot;, the new message could be called &quot;ut_metadata2&quot;. That is versioning.</p></div></blockquote><p>which would mean (assuming object-driven implementation of messaging) that you have to register 1 handler under 2 message names instead of just 1 message name and do the semantic distinction on the message level. It's meant for incremental changes after all...<br /><br />like:<br /><br />foo.bar()<br />// tons of code here....<br /><br />if(version &gt; specific_constant)<br />{<br /> // some tiny code snippet to indicate the changed semantics<br /> ...<br />}<br /><br />//more code<br />foobar();<br /><br /><br /><br /><br /></p><blockquote><div class="incqbox"><p>and bittorrent supports keepalive messages, which has the same effect as padding.</p></div></blockquote><p>Which means doing whatever you do for handling keepalive messages instead of simply dropping the meaningless padding one level further down, and that quite often if add paddings to small messages, like haves or requests...</p>
				</div>
				<div class="postsignature"><hr />Az dev</div>
			</div>
			<div class="clearer"></div>
			<div class="postfootleft"><p>Offline</p></div>
			<div class="postfootright"><div>&nbsp;</div></div>
		</div>
	</div>
</div>

<div id="p86" class="blockpost rowodd">
	<h2><span><span class="conr">#9&nbsp;</span><a href="viewtopic.php?pid=86#p86">2008-03-07 17:54:38</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postleft">
				<dl>
					<dt><strong><a href="profile.php?id=89608">Taskman</a></strong></dt>
					<dd class="usertitle"><strong>Member</strong></dd>
					<dd class="postavatar"></dd>
				</dl>
			</div>
			<div class="postright">
				<h3> Re: Discussion of BEP 10: Extension Protocol</h3>
				<div class="postmsg">
					<p>Is AZMP getting its own BEP?</p>
				</div>
				<div class="postsignature"><hr />Don't mistake your rank and number for superiority. The oldest child may learn from the youngest.</div>
			</div>
			<div class="clearer"></div>
			<div class="postfootleft"><p>Offline</p></div>
			<div class="postfootright"><div>&nbsp;</div></div>
		</div>
	</div>
</div>

<div id="p87" class="blockpost roweven">
	<h2><span><span class="conr">#10&nbsp;</span><a href="viewtopic.php?pid=87#p87">2008-03-07 23:28:45</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postleft">
				<dl>
					<dt><strong><a href="profile.php?id=89602">arvid</a></strong></dt>
					<dd class="usertitle"><strong>Administrator</strong></dd>
					<dd class="postavatar"></dd>
				</dl>
			</div>
			<div class="postright">
				<h3> Re: Discussion of BEP 10: Extension Protocol</h3>
				<div class="postmsg">
					<blockquote><div class="incqbox"><h4>The 8472 wrote:</h4><blockquote><div class="incqbox"><p>I consider that a benefit, and I would phrase it like this: &quot;it blends in with the spirit of the bittorrent protocol as opposed to replacing it&quot;</p></div></blockquote><p>I do not see how keeping (comparatively) stupid legacy features like the bitfield around</p></div></blockquote><p>stupid because?<br /><br /></p><blockquote><div class="incqbox"><p>instead of replacing it with something better, such as dynamic handshaking.</p></div></blockquote><p>which differs from LTEP how?<br /><br /></p><blockquote><div class="incqbox"><p>And i don't see how it's the &quot;spririt of bittorrent&quot; either. To me &quot;the spirit of bittorrent&quot; is efficient, flexible mass distribution of data. The current state is not flexible and slightly inefficient.</p></div></blockquote><p>Well, let me tell you then. It uses essentially the same format for messages. It uses length prefixed messages, one byte message IDs and it uses bencoded handshakes which is a bittorrent encoding.<br /><br /></p><blockquote><div class="incqbox"><blockquote><div class="incqbox"><p>Why incur additional parsing overhead on every message?</p></div></blockquote><p>uhm... if you only have one messaging protocol where every message is a 1st class citizen then i don't see any additional parsing overhead.</p></div></blockquote><p>1st class citizen doesn't mean &quot;represented as a string&quot;. There is no extra parsing overhead in LTEP messages, and it's not because the messages are not first class citizens.<br /><br /></p><blockquote><div class="incqbox"><blockquote><div class="incqbox"><p>For example, if the metadata extension has to be &quot;updated&quot;, the new message could be called &quot;ut_metadata2&quot;. That is versioning.</p></div></blockquote><p>which would mean (assuming object-driven implementation of messaging) that you have to register 1 handler under 2 message names instead of just 1 message name and do the semantic distinction on the message level. It's meant for incremental changes after all...<br /><br />like:<br /><br />foo.bar()<br />// tons of code here....<br /><br />if(version &gt; specific_constant)<br />{<br /> // some tiny code snippet to indicate the changed semantics<br /> ...<br />}<br /><br />//more code<br />foobar();</p></div></blockquote><p>I prefer having complicated code over having complicated protocols. And I especially prefer having complicated code only in the clients that decided to implement something that didn't turn out to work very well and had to change some small piece of how it worked.<br /><br />The clients that only implements the final, fully functional, version would not need any extra logic.<br /><br /></p><blockquote><div class="incqbox"><blockquote><div class="incqbox"><p>and bittorrent supports keepalive messages, which has the same effect as padding.</p></div></blockquote><p>Which means doing whatever you do for handling keepalive messages instead of simply dropping the meaningless padding one level further down, and that quite often if add paddings to small messages, like haves or requests...</p></div></blockquote><p>Right, And if it takes too much time for you to check the current time and update a variable, you could introduce a &quot;pad&quot; extension.</p>
				</div>
			</div>
			<div class="clearer"></div>
			<div class="postfootleft"><p>Offline</p></div>
			<div class="postfootright"><div>&nbsp;</div></div>
		</div>
	</div>
</div>

<div id="p88" class="blockpost rowodd">
	<h2><span><span class="conr">#11&nbsp;</span><a href="viewtopic.php?pid=88#p88">2008-03-08 06:13:29</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postleft">
				<dl>
					<dt><strong><a href="profile.php?id=89618">The 8472</a></strong></dt>
					<dd class="usertitle"><strong>Azureus Developer</strong></dd>
					<dd class="postavatar"></dd>
				</dl>
			</div>
			<div class="postright">
				<h3> Re: Discussion of BEP 10: Extension Protocol</h3>
				<div class="postmsg">
					<blockquote><div class="incqbox"><p>stupid because?</p></div></blockquote><p>Because vendor-prefixed message names are pretty collision-resistant, arbitrarily using bitflags is not... and given the problems of coordination (there was basically none at all) in the past i'd like to have a messaging protocol that does not require a central message registry and a very limited extension pool. With something like LTEP/AZMP as basic protocol (not just an addon) everyone can experiment, add custom extensions etc. w/o causing any significant trouble. With legacy bittorrent it's impossible.<br />And i don't see the purpose of having a bitfield AND a negotation protocol. The latter can do the former's job easily. And only having one protocol, 1 message-ID-space etc. makes things easier... and as you said yourself, you like simple protocols <img src="img/smilies/wink.png" width="15" height="15" alt="wink" /><br /><br /></p><blockquote><div class="incqbox"><p>1st class citizen doesn't mean &quot;represented as a string&quot;.</p></div></blockquote><p>Uhm... i said that was the only <em>drawback</em> of AZMP, i.e. i already said it is something that should be fixed about a common messaging protocol. Please pay more attention <img src="img/smilies/hmm.png" width="15" height="15" alt="hmm" /><br /><br /></p><blockquote><div class="incqbox"><blockquote><div class="incqbox"><p>instead of replacing it with something better, such as dynamic handshaking.</p></div></blockquote><p>which differs from LTEP how?</p></div></blockquote><p>Note the &quot;replacing&quot; not &quot;adding workaround&quot;.<br /><br /></p><blockquote><div class="incqbox"><p>The clients that only implements the final, fully functional, version would not need any extra logic.</p></div></blockquote><p>Uhm... fast extension is a perfect example for that. With azureus we were more liberal with changing the meaning of messages as we had our own messaging protocol etc.<br />So, it does have its use imo.</p>
					<p class="postedit"><em>Last edited by The 8472 (2008-03-08 08:57:13)</em></p>
				</div>
				<div class="postsignature"><hr />Az dev</div>
			</div>
			<div class="clearer"></div>
			<div class="postfootleft"><p>Offline</p></div>
			<div class="postfootright"><div>&nbsp;</div></div>
		</div>
	</div>
</div>

<div id="p89" class="blockpost roweven">
	<h2><span><span class="conr">#12&nbsp;</span><a href="viewtopic.php?pid=89#p89">2008-03-11 17:07:06</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postleft">
				<dl>
					<dt><strong><a href="profile.php?id=89601">dave</a></strong></dt>
					<dd class="usertitle"><strong>Editor</strong></dd>
					<dd class="postavatar"></dd>
				</dl>
			</div>
			<div class="postright">
				<h3> Re: Discussion of BEP 10: Extension Protocol</h3>
				<div class="postmsg">
					<p>AZMP BEP! Please.</p>
				</div>
			</div>
			<div class="clearer"></div>
			<div class="postfootleft"><p>Offline</p></div>
			<div class="postfootright"><div>&nbsp;</div></div>
		</div>
	</div>
</div>

<div id="p90" class="blockpost rowodd">
	<h2><span><span class="conr">#13&nbsp;</span><a href="viewtopic.php?pid=90#p90">2008-03-12 12:53:37</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postleft">
				<dl>
					<dt><strong><a href="profile.php?id=89618">The 8472</a></strong></dt>
					<dd class="usertitle"><strong>Azureus Developer</strong></dd>
					<dd class="postavatar"></dd>
				</dl>
			</div>
			<div class="postright">
				<h3> Re: Discussion of BEP 10: Extension Protocol</h3>
				<div class="postmsg">
					<p>I'll talk to the others about it.</p>
				</div>
				<div class="postsignature"><hr />Az dev</div>
			</div>
			<div class="clearer"></div>
			<div class="postfootleft"><p>Offline</p></div>
			<div class="postfootright"><div>&nbsp;</div></div>
		</div>
	</div>
</div>

<div id="p152" class="blockpost roweven">
	<h2><span><span class="conr">#14&nbsp;</span><a href="viewtopic.php?pid=152#p152">2008-04-14 15:54:34</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postleft">
				<dl>
					<dt><strong><a href="profile.php?id=89687">amc1</a></strong></dt>
					<dd class="usertitle"><strong>Member</strong></dd>
					<dd class="postavatar"></dd>
				</dl>
			</div>
			<div class="postright">
				<h3> Re: Discussion of BEP 10: Extension Protocol</h3>
				<div class="postmsg">
					<p>I wrote up a specification document in the past for AZMP <a href="http://www.azureuswiki.com/index.php/Azureus_messaging_protocol" rel="nofollow">here</a> - there are some points which need clarification though (there are things which are somewhat ambiguous and I can't tell whether they are intentional or just not considered).<br /><br />I'm not entirely sure that it is worth the effort to write a BEP for it, because there's some level of enthusiasm of coming up with an agreed extension protocol.<br /><br />Personally speaking (as the developer who wrote LTEP integration for Azureus), I like LTEP over AZMP just in terms of message overhead (and things like dynamically disabling extensions, which AZMP has no explicit support for) - though I've since grown somewhat fonder of AZMP with what it tries to achieve (for example, the fact that there is some reserved space in the initial handshake to indicate what protocol features are supported, like padding).<br /><br />arvid convinced me in the past that versioning isn't really worth the effort, after my discussions with him to introduce versioning semantics to LTEP (the proposal I wrote can be found <a href="http://wiki.theory.org/BitTorrentLTExtVersionProposal" rel="nofollow">here</a>) - in practice, I don't think version messaging is particular necessary.... for example, the AZ_HANDSHAKE message is a bencoded dictionary, and new adjustments to it haven't resulted in it the version number being increased).<br /><br />Another reason I'm less keen on pushing AZMP is because Azureus currently seems to have v2 of various messages to indicate that padding is supported - yet padding support is surely a protocol-level thing rather than something to be indicated at the message-level. I have it on my to-do list as something to resolve, but I wouldn't bother with it if we moved to another protocol.</p>
				</div>
				<div class="postsignature"><hr />Azureus Developer</div>
			</div>
			<div class="clearer"></div>
			<div class="postfootleft"><p>Offline</p></div>
			<div class="postfootright"><div>&nbsp;</div></div>
		</div>
	</div>
</div>

<div id="p154" class="blockpost rowodd">
	<h2><span><span class="conr">#15&nbsp;</span><a href="viewtopic.php?pid=154#p154">2008-04-14 17:04:57</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postleft">
				<dl>
					<dt><strong><a href="profile.php?id=89601">dave</a></strong></dt>
					<dd class="usertitle"><strong>Editor</strong></dd>
					<dd class="postavatar"></dd>
				</dl>
			</div>
			<div class="postright">
				<h3> Re: Discussion of BEP 10: Extension Protocol</h3>
				<div class="postmsg">
					<p>Thanks AMC1 for the AZMP description.</p>
				</div>
			</div>
			<div class="clearer"></div>
			<div class="postfootleft"><p>Offline</p></div>
			<div class="postfootright"><div>&nbsp;</div></div>
		</div>
	</div>
</div>

<div id="p191" class="blockpost roweven">
	<h2><span><span class="conr">#16&nbsp;</span><a href="viewtopic.php?pid=191#p191">2008-05-03 04:11:41</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postleft">
				<dl>
					<dt><strong><a href="profile.php?id=89618">The 8472</a></strong></dt>
					<dd class="usertitle"><strong>Azureus Developer</strong></dd>
					<dd class="postavatar"></dd>
				</dl>
			</div>
			<div class="postright">
				<h3> Re: Discussion of BEP 10: Extension Protocol</h3>
				<div class="postmsg">
					<p>Alus and i agreed on a new header field: <em>upload_only</em>, it is set to <em>1</em> when the peer is not downloading, either due to being a seed or using selective downloading and having finished all files he's interested in.<br /><br />This allows for various disconnect-seeds behaviors to be extended to partial seeds.</p>
					<p class="postedit"><em>Last edited by The 8472 (2008-05-03 04:12:43)</em></p>
				</div>
				<div class="postsignature"><hr />Az dev</div>
			</div>
			<div class="clearer"></div>
			<div class="postfootleft"><p>Offline</p></div>
			<div class="postfootright"><div>&nbsp;</div></div>
		</div>
	</div>
</div>

<div id="p192" class="blockpost rowodd">
	<h2><span><span class="conr">#17&nbsp;</span><a href="viewtopic.php?pid=192#p192">2008-05-03 08:15:11</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postleft">
				<dl>
					<dt><strong><a href="profile.php?id=89609">Olaf van der Spek</a></strong></dt>
					<dd class="usertitle"><strong>Member</strong></dd>
					<dd class="postavatar"></dd>
				</dl>
			</div>
			<div class="postright">
				<h3> Re: Discussion of BEP 10: Extension Protocol</h3>
				<div class="postmsg">
					<blockquote><div class="incqbox"><p>upload_only, it is set to 1 when the peer is not downloading,</p></div></blockquote><p>Why not call it download(ing) and avoid the negation?</p>
				</div>
			</div>
			<div class="clearer"></div>
			<div class="postfootleft"><p>Offline</p></div>
			<div class="postfootright"><div>&nbsp;</div></div>
		</div>
	</div>
</div>

<div id="p193" class="blockpost roweven">
	<h2><span><span class="conr">#18&nbsp;</span><a href="viewtopic.php?pid=193#p193">2008-05-03 08:28:34</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postleft">
				<dl>
					<dt><strong><a href="profile.php?id=89618">The 8472</a></strong></dt>
					<dd class="usertitle"><strong>Azureus Developer</strong></dd>
					<dd class="postavatar"></dd>
				</dl>
			</div>
			<div class="postright">
				<h3> Re: Discussion of BEP 10: Extension Protocol</h3>
				<div class="postmsg">
					<p>it does not matter... negations are almost always arbitrary and simply depend on your train of thought. we basically want to know when the client is (partially) seeding, in that case it's not a negation. I only used the negation to define it.</p>
					<p class="postedit"><em>Last edited by The 8472 (2008-05-03 08:49:55)</em></p>
				</div>
				<div class="postsignature"><hr />Az dev</div>
			</div>
			<div class="clearer"></div>
			<div class="postfootleft"><p>Offline</p></div>
			<div class="postfootright"><div>&nbsp;</div></div>
		</div>
	</div>
</div>

<div id="p195" class="blockpost rowodd">
	<h2><span><span class="conr">#19&nbsp;</span><a href="viewtopic.php?pid=195#p195">2008-05-04 03:11:47</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postleft">
				<dl>
					<dt><strong><a href="profile.php?id=89609">Olaf van der Spek</a></strong></dt>
					<dd class="usertitle"><strong>Member</strong></dd>
					<dd class="postavatar"></dd>
				</dl>
			</div>
			<div class="postright">
				<h3> Re: Discussion of BEP 10: Extension Protocol</h3>
				<div class="postmsg">
					<p>What if a peer is not uploading and not downloading? <img src="img/smilies/wink.png" width="15" height="15" alt="wink" /><br />You're really only interested in whether the peer will potentially download from you. If not, you disconnect it.</p>
				</div>
			</div>
			<div class="clearer"></div>
			<div class="postfootleft"><p>Offline</p></div>
			<div class="postfootright"><div>&nbsp;</div></div>
		</div>
	</div>
</div>

<div id="p266" class="blockpost roweven">
	<h2><span><span class="conr">#20&nbsp;</span><a href="viewtopic.php?pid=266#p266">2008-07-10 15:01:30</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postleft">
				<dl>
					<dt><strong><a href="profile.php?id=89618">The 8472</a></strong></dt>
					<dd class="usertitle"><strong>Azureus Developer</strong></dd>
					<dd class="postavatar"></dd>
				</dl>
			</div>
			<div class="postright">
				<h3> Re: Discussion of BEP 10: Extension Protocol</h3>
				<div class="postmsg">
					<p>a little update: upload_only = 1 shouldn't be sent when the peer is using lazy bitfields as this might get him disconnected since the other side doesn't expect him to &quot;download&quot; further pieces (send have messages).</p>
				</div>
				<div class="postsignature"><hr />Az dev</div>
			</div>
			<div class="clearer"></div>
			<div class="postfootleft"><p>Offline</p></div>
			<div class="postfootright"><div>&nbsp;</div></div>
		</div>
	</div>
</div>

<div id="p374" class="blockpost rowodd">
	<h2><span><span class="conr">#21&nbsp;</span><a href="viewtopic.php?pid=374#p374">2008-08-20 16:42:23</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postleft">
				<dl>
					<dt><strong><a href="profile.php?id=30435">bram</a></strong></dt>
					<dd class="usertitle"><strong>Administrator</strong></dd>
					<dd class="postavatar"></dd>
				</dl>
			</div>
			<div class="postright">
				<h3> Re: Discussion of BEP 10: Extension Protocol</h3>
				<div class="postmsg">
					<p>Any sort of handshake protocol is going to have to require some generally agreed-upon semantics to work properly. To date, BitTorrent peers always follow the semantics of 'if both sides support it, we use it, otherwise we don't'. To create anything more complicated would be just plain a bad idea. There has not to date been any issues with collisions in the bitfield, nor are there likely to be any in the future. Protocol compatibility problems are generally caused by unnecessary complexity which gets implemented wrong.<br /><br />AZMP mostly just makes the protocol more java-like by creating an extra layer of abstraction which doesn't do anything, because that's the sort of thing you do in java.</p>
				</div>
			</div>
			<div class="clearer"></div>
			<div class="postfootleft"><p>Offline</p></div>
			<div class="postfootright"><div>&nbsp;</div></div>
		</div>
	</div>
</div>

<div id="p377" class="blockpost roweven">
	<h2><span><span class="conr">#22&nbsp;</span><a href="viewtopic.php?pid=377#p377">2008-08-20 17:08:18</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postleft">
				<dl>
					<dt><strong><a href="profile.php?id=89618">The 8472</a></strong></dt>
					<dd class="usertitle"><strong>Azureus Developer</strong></dd>
					<dd class="postavatar"></dd>
				</dl>
			</div>
			<div class="postright">
				<h3> Re: Discussion of BEP 10: Extension Protocol</h3>
				<div class="postmsg">
					<blockquote><div class="incqbox"><p>AZMP mostly just makes the protocol more java-like by creating an extra layer of abstraction which doesn't do anything, because that's the sort of thing you do in java.</p></div></blockquote><p>is that supposed to be some bashing?<br /><br />but anyway, you got it wrong. we're not adding a layer of abstraction. we're running a stand-alone protocol with some legacy bittorrent headers. azmp could be used w/o any preceding bittorrent handshake (and is in fact used that way internally).<br />I don't see how that's adding a layer of abstraction onto bittorrent.<br /><br />LTEP is actually more of an abstraction layer as it adds negotiable messaging inside a specific bittorrent message.<br /><br /><br /><br />Anyway, imo the reserved bitfield is an anachronism that should die out asap as it requires coordinated, centralized negotiation of which bits should identify which messages and does not correlate bits with message IDs, which means that reserved bits and messages ids are independent sources for potential collisions. Negotiated messages (with vendor-prefixes in their names for example) are practically collision-resistant and message IDs can be derived automatically from them. This allows for much greater flexibility in testing new messages or adding custom/optional/private extensions w/o causing any significant compatibility issues.</p>
					<p class="postedit"><em>Last edited by The 8472 (2008-08-20 17:16:32)</em></p>
				</div>
				<div class="postsignature"><hr />Az dev</div>
			</div>
			<div class="clearer"></div>
			<div class="postfootleft"><p>Offline</p></div>
			<div class="postfootright"><div>&nbsp;</div></div>
		</div>
	</div>
</div>

<div id="p389" class="blockpost rowodd">
	<h2><span><span class="conr">#23&nbsp;</span><a href="viewtopic.php?pid=389#p389">2008-08-26 21:01:49</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postleft">
				<dl>
					<dt><strong><a href="profile.php?id=89601">dave</a></strong></dt>
					<dd class="usertitle"><strong>Editor</strong></dd>
					<dd class="postavatar"></dd>
				</dl>
			</div>
			<div class="postright">
				<h3> Re: Discussion of BEP 10: Extension Protocol</h3>
				<div class="postmsg">
					<p>Bram,<br /><br />There have been collisions-- or rather at least one.<br /><br /></p><blockquote><div class="incqbox"><h4>Arvid wrote:</h4><p>DHT port message collided with XBT client's peer exchange message.</p></div></blockquote><p>I agree with 8472 here except that we should use LTEP rather then AZMP.&nbsp; &nbsp;If we rev the protocol, we could fold the most useful extensions into the revision, eliminate the reserved bits and use LTEP for everything else.</p>
				</div>
			</div>
			<div class="clearer"></div>
			<div class="postfootleft"><p>Offline</p></div>
			<div class="postfootright"><div>&nbsp;</div></div>
		</div>
	</div>
</div>

<div id="p403" class="blockpost roweven">
	<h2><span><span class="conr">#24&nbsp;</span><a href="viewtopic.php?pid=403#p403">2008-08-29 13:14:49</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postleft">
				<dl>
					<dt><strong><a href="profile.php?id=30435">bram</a></strong></dt>
					<dd class="usertitle"><strong>Administrator</strong></dd>
					<dd class="postavatar"></dd>
				</dl>
			</div>
			<div class="postright">
				<h3> Re: Discussion of BEP 10: Extension Protocol</h3>
				<div class="postmsg">
					<p>Getting back to the original discussion of LTEP, there's some lack of clarity in this BEP.<br /><br />Do the original protocol messages keep their message numbers? (I assume yes). For the example, aren't the message numbers 1 and 2 already taken by original messages?<br /><br />Also, there's a general lack of clarify around the semantics of declarations of handling messages. If there's a feature which requires a particular message, is support for that feature declared by declaring support for the message? If both sides don't declare support for a message, should it never be sent? What about features which require multiple messages? What if a feature requires two messages but only support for one is declared? Should a peer disconnect if it gets a message it doesn't handle, or should it simply ignore it?<br /><br />Documentation of what's currently implemented and guidelines for future messages and extensions are needed.</p>
				</div>
			</div>
			<div class="clearer"></div>
			<div class="postfootleft"><p>Offline</p></div>
			<div class="postfootright"><div>&nbsp;</div></div>
		</div>
	</div>
</div>

<div id="p405" class="blockpost rowodd">
	<h2><span><span class="conr">#25&nbsp;</span><a href="viewtopic.php?pid=405#p405">2008-08-29 14:21:11</a></span></h2>
	<div class="box">
		<div class="inbox">
			<div class="postleft">
				<dl>
					<dt><strong><a href="profile.php?id=89618">The 8472</a></strong></dt>
					<dd class="usertitle"><strong>Azureus Developer</strong></dd>
					<dd class="postavatar"></dd>
				</dl>
			</div>
			<div class="postright">
				<h3> Re: Discussion of BEP 10: Extension Protocol</h3>
				<div class="postmsg">
					<blockquote><div class="incqbox"><p>Once support for the protocol is established, the client is supposed to support 1 new message:<br />name &nbsp; &nbsp; id<br />extended &nbsp; &nbsp; 20<br /><br />This message is sent as any other bittorrent message, with a 4 byte length prefix and a single byte identifying the message (the single byte being 20 in this case). At the start of the payload of the message, is a single byte message identifier.</p></div></blockquote><p>It creates an independent message id space. Original messages are transmitted using the old message IDs, creating 2nd class messages which fall outside the message name space, while extension messages use the fully negotiated extension ID space.<br /><br />This is just one of the issues i actually listed here: <a href="http://forum.bittorrent.org/viewtopic.php?pid=36#p36" rel="nofollow">http://forum.bittorrent.org/viewtopic.php?pid=36#p36</a> ...</p>
					<p class="postedit"><em>Last edited by The 8472 (2008-08-29 17:19:50)</em></p>
				</div>
				<div class="postsignature"><hr />Az dev</div>
			</div>
			<div class="clearer"></div>
			<div class="postfootleft"><p>Offline</p></div>
			<div class="postfootright"><div>&nbsp;</div></div>
		</div>
	</div>
</div>

<div class="postlinksb">
	<div class="inbox">
		<p class="postlink conr">&nbsp;</p>
		<p class="pagelink conl">Pages: <strong>1</strong>&nbsp;<a href="viewtopic.php?id=16&amp;p=2">2</a></p>
		<ul><li><a href="index.php">Index</a></li><li>&nbsp;&raquo;&nbsp;<a href="viewforum.php?id=25">BEPs</a></li><li>&nbsp;&raquo;&nbsp;Discussion of BEP 10: Extension Protocol</li></ul>
		<div class="clearer"></div>
	</div>
</div>

<div id="brdfooter" class="block">
	<h2><span>Board footer</span></h2>
	<div class="box">
		<div class="inbox">

			<div class="conl">
				<form id="qjump" method="get" action="viewforum.php">
					<div><label>Jump to
					<br /><select name="id" onchange="window.location=('viewforum.php?id='+this.options[this.selectedIndex].value)">
						<optgroup label="BitTorrent">
							<option value="26">Announcements</option>
							<option value="25" selected="selected">BEPs</option>
							<option value="29">BEP process</option>
							<option value="27">General</option>
							<option value="33">Research Tools</option>
							<option value="32">Cooperation between BitTorrent and ISPs</option>
							<option value="30">Attacks against BitTorrent</option>
							<option value="28">Feature Requests, Found Bugs &gt;&gt;&gt;</option>
					</optgroup>
					</select>
					<input type="submit" value=" Go " accesskey="g" />
					</label></div>
				</form>
			</div>
			<p class="conr">Powered by <a href="http://fluxbb.org/">FluxBB</a></p>
			<div class="clearer"></div>
		</div>
	</div>
</div>

</div>
</div>

<script src="http://www.google-analytics.com/urchin.js" type="text/javascript">
</script>
<script type="text/javascript">
_uacct = "UA-116155-1";
_udn = "utorrent.com";
urchinTracker();
</script>

</body>
</html>
